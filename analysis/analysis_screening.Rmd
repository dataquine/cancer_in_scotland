---
title: 'Cancer Screening programmes in Scotland'
author: "Lesley Duff"
date: "`r format(Sys.Date())`"
output:
  html_document:
    toc: true
    toc_depth: 4
    df_print: paged
---
```{r setup_screening, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  error = FALSE,
  message = FALSE
)
```
# Screening

```{r}
library(here)
library(skimr)
library(tidyverse)
```

```{r}
source(here::here("R/phs_data_info.R"))
source(here::here("R/screening.R"))
source(here::here("R/theming.R"))
# Retrieve helper functions for manipulating bowel cancer screening data
```
```{r}
# Set custom theme
theme_set(theme_cancer_in_scotland())
```

## Scottish Bowel Screening Programme

Commenced in 2007 with a full rollout across all health boards by 2009.

People aged 50-74 years are invited every two years to complete a home bowel 
screening test. 75 and over can self-refer. 

### Uptake

The [Healthcare Improvement Scotland
(HIS) standard target](https://www.healthcareimprovementscotland.org/our_work/standards_and_guidelines/stnds/bowel_screening_standards.aspx) for bowel screening is **uptake is 60%**. 

Based on [Scottish bowel screening programme statistics For the period of invitations from May 2020 to April 2022](https://publichealthscotland.scot/publications/scottish-bowel-screening-programme-statistics/scottish-bowel-screening-programme-statistics-for-the-period-of-invitations-from-may-2020-to-april-2022/)

"The proportion of invites which are returned as a correctly
completed kit (i.e. a positive or negative test result). It is a key measure of the
acceptability of the test to the public."

Health Improvement Scotland [Bowel screening standards: August 2023 (PDF)](https://www.healthcareimprovementscotland.org/his/idoc.ashx?docid=49b039aa-f6cf-42aa-8fda-3d6bc165bd21&version=-1).

```{r}
screening_bowel_cancer_takeup_all <- read_csv(here::here(
  "data_clean", phs_screening_bowel_uptake_filepath
))
```

```{r eval=FALSE, include=FALSE}
dim(screening_bowel_cancer_takeup_all)
# 45 rows 3 columns

# Examine data
glimpse(screening_bowel_cancer_takeup_all)
skimr::skim(screening_bowel_cancer_takeup_all)

# The area column represents both health boards and all of Scotland so be
# careful to filter our results if e.g. only health boards requires
```

```{r eval=FALSE, include=FALSE}
#View(screening_bowel_cancer_takeup)
head(screening_bowel_cancer_takeup_all)
```

## All Scotland
```{r}
screening_bowel_cancer_takeup_scotland <- get_screening_bowel_cancer_takeup_scotland(screening_bowel_cancer_takeup_all)

DT::datatable(screening_bowel_cancer_takeup_scotland,
                options = list(searching = FALSE, paging = FALSE),
                caption = "Data for May 2020 to April 2022"
              )

plot_screening_bowel_cancer_takeup_scotland <- plot_screening_bowel_cancer_takeup_scotland(screening_bowel_cancer_takeup_scotland)
plot_screening_bowel_cancer_takeup_scotland
ggsave(here::here(screening_bowel_cancer_uptake_plot_filepath), 
       plot_screening_bowel_cancer_takeup_scotland)
```

This shows that in the current Bowel Cancer Screening latest results around 2/3 
of the people invited via the screening programme are taking up the offer. The 
red dotted horizontal line marks the Health Improvement Scotland standard target 
of `r screening_bowel_cancer_uptake_target`%.

Females are more likely to return the tests than males.

For the most recent round of testing the target has been met and exceeded by a
clear margin.

Continue to enhance communication to try and engage the remaining third of the 
general public making more efforts to target males.

**Conclusion: `r screening_bowel_cancer_uptake_target`% target is being met but room for improvement**.

## All people by health board
```{r}
screening_bowel_cancer_takeup_health_boards <-
  get_screening_bowel_cancer_takeup(
    screening_bowel_cancer_takeup_all,
    # filter_sex = c("Females","Males"),
    filter_sex = c("All persons"),
    # filter_area = c("Grampian", "Fife"),
    remove_scotland = TRUE
  )

DT::datatable(screening_bowel_cancer_takeup_health_boards,
                options = list(searching = FALSE, paging = FALSE),
                caption = "Data for May 2020 to April 2022"
              )
```


```{r}
# screening_bowel_cancer_takeup_kpi <-
#  get_screening_bowel_cancer_takeup_kpi1(screening_bowel_cancer_takeup)
# screening_bowel_cancer_takeup_kpi

# View(screening_bowel_cancer_takeup_kpi)
# screening_bowel_cancer_takeup_kpi %>%
#  ggplot()
# hist(x = uptake_pct,
#   col = "#75AADB", border = "white",
#         xlab = "Waiting time to next eruption (in mins)",
#         main = "Histogram of waiting times")
```
